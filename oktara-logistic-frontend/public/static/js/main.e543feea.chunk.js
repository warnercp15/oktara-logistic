(this["webpackJsonpoktara-logistic-frontend"]=this["webpackJsonpoktara-logistic-frontend"]||[]).push([[0],{16:function(e,t,a){e.exports={navbar:"Header_navbar__25Nse",logo:"Header_logo__1w8sw","logo-secondary":"Header_logo-secondary__3kVNS",menu:"Header_menu__1JD1z",burger:"Header_burger__7-5qu","burger-open":"Header_burger-open__2ydst","links-container":"Header_links-container__1n3bw","links-container-open":"Header_links-container-open__fd_SO",link:"Header_link__1k3K0",fill:"Header_fill__2pYvg","link-active":"Header_link-active__5DSAB"}},58:function(e,t,a){e.exports={footer:"Footer_footer__N-JuZ"}},96:function(e,t,a){},97:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(33),s=a.n(r),o=a(20),i=a.n(o),u=Object(n.createContext)({}),l=Object(n.createContext)({}),d=a(58),p=a.n(d),j=a(2);function b(e){e.children;return Object(j.jsx)("footer",{className:p.a.footer,children:"\xa9 2022 Oktara Logistic"})}var h=a(23),f=a(8),O=a(9),m=a(16),g=a.n(m),x=[{text:"Packages",url:"/Packages"},{text:"Manage",url:"/Manage"}],v=function(e){var t=e.open,a=e.setOpen;return Object(j.jsxs)("button",{className:"".concat(g.a.burger).concat(t?" ".concat(g.a["burger-open"]):""),type:"button",onClick:function(){a(!t)},children:[Object(j.jsx)("div",{}),Object(j.jsx)("div",{}),Object(j.jsx)("div",{})]})},k=function(e){var t=e.open,a=Object(O.f)();return Object(j.jsx)("div",{className:"".concat(g.a["links-container"]).concat(t?" ".concat(g.a["links-container-open"]):""),children:x.map((function(e){return Object(j.jsx)(h.b,{to:e.url,className:"".concat(g.a.link," ").concat(a.pathname===e.url?g.a["link-active"]:""),children:e.text},e.text)}))})};function y(){var e=Object(n.useState)(!1),t=Object(f.a)(e,2),a=t[0],c=t[1];return Object(j.jsxs)("div",{className:g.a.menu,children:[Object(j.jsx)(v,{open:a,setOpen:c}),Object(j.jsx)(k,{open:a})]})}function P(){return Object(j.jsx)("header",{children:Object(j.jsxs)("nav",{className:g.a.navbar,children:[Object(j.jsxs)(h.b,{to:"/",className:g.a.logo,children:["Oktara",Object(j.jsx)("span",{className:g.a["logo-secondary"],children:"Logistic"})]}),Object(j.jsx)(y,{})]})})}function w(e){var t=e.children;return Object(j.jsxs)("div",{className:"root",children:[Object(j.jsx)(P,{}),Object(j.jsx)("main",{children:t}),Object(j.jsx)(b,{})]})}var S=a(11),_=a(4),L=a.n(_),C=a(6),N=Object(n.createContext)({}),M=a(41),R=a.n(M),E=R.a.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:function(e){e.addEventListener("mouseenter",R.a.stopTimer),e.addEventListener("mouseleave",R.a.resumeTimer)}}),H=function(){var e=Object(C.a)(L.a.mark((function e(){return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){navigator.geolocation.getCurrentPosition((function(t){var a=t.coords;e([a.longitude,a.latitude])}),(function(e){alert("No se pudo obtener la geolocalizacion"),console.log(e),t()}))})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=a(28),B=I.a.create({baseURL:"https://api.mapbox.com/directions/v5/mapbox/driving",params:{alternatives:!1,geometries:"geojson",overview:"simplified",steps:!1,access_token:"pk.eyJ1IjoiY2FybG9zMzg5NyIsImEiOiJja25zMWs1YjgwMjhxMnB0aHBud3pkeG5qIn0.JhmYR1NECWhcO7KCEdpnkA"}}),T=I.a.create({baseURL:"https://oktara-logistic-backend.herokuapp.com/"}),J=I.a.create({baseURL:"https://api.mapbox.com/geocoding/v5/mapbox.places",params:{limit:5,language:"es",access_token:"pk.eyJ1IjoiY2FybG9zMzg5NyIsImEiOiJja25zMWs1YjgwMjhxMnB0aHBud3pkeG5qIn0.JhmYR1NECWhcO7KCEdpnkA"}}),z=function(e){var t=e.isShowing,a=e.hide,n=e.children;return t?s.a.createPortal(Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("div",{className:"modal-overlay"}),Object(j.jsx)("div",{className:"modal-wrapper","aria-modal":!0,"aria-hidden":!0,tabIndex:-1,role:"dialog",children:Object(j.jsxs)("div",{className:"modal",children:[Object(j.jsx)("div",{className:"modal-header",children:Object(j.jsx)("button",{type:"button",className:"modal-close-button","data-dismiss":"modal","aria-label":"Close",onClick:a,style:{marginBottom:".5em"},children:Object(j.jsx)("span",{"aria-hidden":"true",children:"\xd7"})})}),n]})})]}),document.body):null},Y=function(){var e=Object(n.useState)(!1),t=Object(f.a)(e,2),a=t[0],c=t[1];return{isShowing:a,toggle:function(){c(!a)}}},F=a(39);function W(e){var t=e.pack,a=Object(n.useContext)(N),c=a.addShipment,r=a.shipments,s=t.location,o=t.name,i=t.status,u=Object(O.f)();return Object(j.jsxs)(F.a,{className:i+"Packages",children:[Object(j.jsxs)("p",{children:["ID: ",s.id]}),Object(j.jsxs)("p",{children:["Name: ",o]}),Object(j.jsx)("p",{className:i+"Status",children:i}),"/Manage"===u.pathname&&"Pending"===i&&!(null===r||void 0===r?void 0:r.includes(t))&&Object(j.jsx)("button",{onClick:function(){return c(t)},children:"Prepare"})]})}var q=a(3),G=a(63);function A(){var e=Object(n.useState)(),t=Object(f.a)(e,2),a=t[0],c=t[1],r=Object(n.useState)(""),s=Object(f.a)(r,2),o=s[0],i=s[1],l=Object(n.useState)(""),d=Object(f.a)(l,2),p=d[0],b=d[1],h=Object(G.a)().register,O=Object(n.useContext)(u),m=O.searchPlacesByTerm,g=O.setPlaces,x=O.isLoadingPlaces,v=O.places,k=Object(n.useContext)(N),y=k.refreshPackages,P=k.packages,w=Object(n.useRef)(),S=function(e){return P.some((function(t){return t.location.id===e&&"Pending"===t.status}))},_=function(){var e=Object(C.a)(L.a.mark((function e(t){return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),""!==p&&""!==o){e.next=4;break}return E.fire({icon:"error",title:"All fields required"}),e.abrupt("return");case 4:if(S(a.id)){e.next=17;break}return e.prev=5,e.next=8,T.post("/setPackages",{name:p,location:a,status:"Pending"});case 8:200===e.sent.status&&(E.fire({icon:"success",title:"Package created"}),y(),b(""),i("")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),console.log(e.t0);case 15:e.next=18;break;case 17:E.fire({icon:"error",title:"This package already exist"});case 18:case"end":return e.stop()}}),e,null,[[5,12]])})));return function(t){return e.apply(this,arguments)}}();return Object(j.jsxs)("form",{children:[Object(j.jsx)("input",Object(q.a)(Object(q.a)({},h("name",{required:!0})),{},{placeholder:"Name",onChange:function(e){return b(e.target.value)},value:p,required:!0})),Object(j.jsx)("input",Object(q.a)(Object(q.a)({},h("location",{required:!0})),{},{placeholder:"Location",onChange:function(e){i(e.target.value),w.current&&clearTimeout(w.current),w.current=setTimeout((function(){m(e.target.value)}),500)},value:o,required:!0})),x&&Object(j.jsx)(j.Fragment,{children:"Loading"}),0===v.length?Object(j.jsx)(j.Fragment,{}):Object(j.jsx)("div",{style:{maxHeight:"350px",overflowY:"auto",display:"flex",flexDirection:"column",alignItems:"center",border:"1px dashed gray ",margin:"1.5em auto",padding:".5em"},children:null===v||void 0===v?void 0:v.map((function(e){return Object(j.jsx)(F.a,{className:"CardContainer",style:{color:"black",textAlign:"center",display:"flex",flexDirection:"row",alignItems:"center",cursor:"pointer"},onClick:function(){i(e.place_name),c(e),g([])},children:Object(j.jsx)("p",{style:{fontSize:"12px"},children:e.place_name})},e.id)}))}),Object(j.jsx)("input",{type:"submit",value:"Create",onClick:_})]})}function D(){var e=Y(),t=e.isShowing,a=e.toggle,c=Object(n.useContext)(N),r=c.shipments,s=c.refresh,o=c.refreshPackages,i=c.packages,d=c.setPackages,p=c.clearShipments,b=Object(n.useContext)(u).userLocation,h=Object(n.useContext)(l).getRouteBetweenPoints,O=function(){var e=Object(C.a)(L.a.mark((function e(){var t;return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.get("/getPackages");case 3:200===(t=e.sent).status&&d(t.data.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),m=function(){var e=Object(C.a)(L.a.mark((function e(){var t;return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.put("/updatePackage",{list:r.map((function(e){return e.location.id})),status:"Shipped"});case 3:200===(t=e.sent).status&&d(t.data.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){O()}),[s]),Object(j.jsxs)("div",{className:"Package",children:[Object(j.jsxs)("div",{children:[Object(j.jsx)("button",{className:"button",onClick:a,children:"Create Package"}),Object(j.jsx)("button",{className:"button",onClick:function(){if(b)if(r.length<=0)E.fire({icon:"error",title:"No packages for Shipments"});else{var e="";e+=b.join(",")+";";var t,a=Object(S.a)(r);try{for(a.s();!(t=a.n()).done;){var n=t.value,c=Object(f.a)(n.location.center,2),s=c[0],i=c[1];e+="".concat(s,",").concat(i,";")}}catch(u){a.e(u)}finally{a.f()}e=e.slice(0,-1);try{h(b,e),setTimeout((function(){m(),p(),o()}),5e3)}catch(l){console.log(l)}setTimeout((function(){m(),p(),o()}),5e3)}},children:"Send Package"})]}),Object(j.jsxs)("div",{className:"PackageContent",children:[Object(j.jsxs)("div",{children:[Object(j.jsx)("h3",{children:"Pending Packages"}),i&&(null===i||void 0===i?void 0:i.filter((function(e){return"Pending"===e.status})).reverse().map((function(e){return Object(j.jsx)(W,{pack:e},e.location.id)})))]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("h3",{children:"Shipped Packages"}),i&&(null===i||void 0===i?void 0:i.filter((function(e){return"Shipped"===e.status})).reverse().map((function(e){return Object(j.jsx)(W,{pack:e},e.location.id)})))]})]}),Object(j.jsx)(z,{isShowing:t,hide:a,children:Object(j.jsx)(A,{})})]})}var U=function(){var e=Object(n.useContext)(u),t=e.isLoading,a=e.userLocation,c=Object(n.useContext)(l).setMap,r=Object(n.useRef)(null);return Object(n.useLayoutEffect)((function(){if(!t){var e=new o.Map({container:r.current,style:"mapbox://styles/mapbox/light-v10",center:a,zoom:7});c(e)}}),[t,a]),Object(j.jsx)(w,{children:Object(j.jsxs)("div",{children:[Object(j.jsx)("div",{ref:r,style:{height:450}}),Object(j.jsx)(D,{})]})})};function Z(){var e=Object(n.useContext)(N),t=e.refresh,a=e.packages,c=e.setPackages,r=function(){var e=Object(C.a)(L.a.mark((function e(){var t;return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.get("/getPackages");case 3:200===(t=e.sent).status&&c(t.data.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){r()}),[t]),Object(j.jsx)(w,{children:Object(j.jsxs)("div",{className:"Container",children:[Object(j.jsx)("h2",{children:"All Packages"}),Object(j.jsx)("div",{children:a&&a.map((function(e){return Object(j.jsx)(W,{pack:e},e.location.id)}))})]})})}var K=function(e,t){switch(t.type){case"setMap":return Object(q.a)(Object(q.a)({},e),{},{isMapReady:!0,map:t.payload});case"setMarkers":return Object(q.a)(Object(q.a)({},e),{},{markers:t.payload});default:return e}},V={isMapReady:!1,map:void 0,markers:[]},Q=function(e){var t=e.children,a=Object(n.useReducer)(K,V),c=Object(f.a)(a,2),r=c[0],s=c[1],i=Object(n.useContext)(N).shipments,u=function(){var e=Object(C.a)(L.a.mark((function e(t,a){var n,c,s,i,u,l,d,p,j,b,h,f;return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.get("/".concat(a));case 2:i=e.sent,u=i.data.routes[0].geometry,l=u.coordinates,d=new o.LngLatBounds(t,t),p=Object(S.a)(l);try{for(p.s();!(j=p.n()).done;)b=j.value,h=[b[0],b[1]],d.extend(h)}catch(O){p.e(O)}finally{p.f()}f={type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:l}}]}},(null===(n=r.map)||void 0===n?void 0:n.getLayer("RouteString"))&&(r.map.removeLayer("RouteString"),r.map.removeSource("RouteString")),null===(c=r.map)||void 0===c||c.addSource("RouteString",f),null===(s=r.map)||void 0===s||s.addLayer({id:"RouteString",type:"line",source:"RouteString",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"black","line-width":3}});case 12:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){var e;r.markers.forEach((function(e){return e.remove()})),(null===(e=r.map)||void 0===e?void 0:e.getLayer("RouteString"))&&(r.map.removeLayer("RouteString"),r.map.removeSource("RouteString"));var t,a=[],n=Object(S.a)(i);try{for(n.s();!(t=n.n()).done;){var c=t.value,u=Object(f.a)(c.location.center,2),l=u[0],d=u[1],p=(new o.Popup).setHTML("\n        <h6>".concat(c.location.text_es,"</h6>\n        <p>").concat(c.location.place_name_es,"</p>\n      ")),j=(new o.Marker).setPopup(p).setLngLat([l,d]).addTo(r.map);a.push(j)}}catch(b){n.e(b)}finally{n.f()}s({type:"setMarkers",payload:a})}),[i]),Object(j.jsx)(l.Provider,{value:Object(q.a)(Object(q.a)({},r),{},{setMap:function(e){var t=(new o.Popup).setHTML("\n      <h4>We are here</h4>\n    ");new o.Marker({color:"#000000"}).setLngLat(e.getCenter()).setPopup(t).addTo(e),s({type:"setMap",payload:e})},getRouteBetweenPoints:u}),children:t})},X=a(7),$=function(e,t){switch(t.type){case"refreshPackages":return Object(q.a)(Object(q.a)({},e),{},{refresh:!e.refresh});case"setPackages":return Object(q.a)(Object(q.a)({},e),{},{packages:t.payload});case"addShipment":return Object(q.a)(Object(q.a)({},e),{},{shipments:[].concat(Object(X.a)(e.shipments),[t.payload])});case"removeShipment":return Object(q.a)(Object(q.a)({},e),{},{shipments:Object(X.a)(t.payload)});case"clearShipments":return Object(q.a)(Object(q.a)({},e),{},{shipments:[]});default:return e}},ee={refresh:!1,packages:[],shipments:[]},te=function(e){var t=e.children,a=Object(n.useReducer)($,ee),c=Object(f.a)(a,2),r=c[0],s=c[1];return Object(j.jsx)(N.Provider,{value:Object(q.a)(Object(q.a)({},r),{},{refreshPackages:function(){s({type:"refreshPackages"})},setPackages:function(e){s({type:"setPackages",payload:e})},addShipment:function(e){s({type:"addShipment",payload:e})},removeShipment:function(e){var t=r.shipments.indexOf(e);r.shipments.splice(t,1),s({type:"removeShipment",payload:r.shipments})},clearShipments:function(){s({type:"clearShipments"})}}),children:t})},ae=function(e,t){switch(t.type){case"setUserLocation":return Object(q.a)(Object(q.a)({},e),{},{isLoading:!1,userLocation:t.payload});case"setLoadingPlaces":return Object(q.a)(Object(q.a)({},e),{},{isLoadingPlaces:!0,places:[]});case"setPlaces":return Object(q.a)(Object(q.a)({},e),{},{isLoadingPlaces:!1,places:t.payload});default:return e}},ne={isLoading:!0,userLocation:void 0,isLoadingPlaces:!1,places:[],packages:[]},ce=function(e){var t=e.children,a=Object(n.useReducer)(ae,ne),c=Object(f.a)(a,2),r=c[0],s=c[1],o=function(){var e=Object(C.a)(L.a.mark((function e(t){var a;return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=3;break}return s({type:"setPlaces",payload:[]}),e.abrupt("return",[]);case 3:if(r.userLocation){e.next=5;break}throw new Error("No hay ubicacion del usuario");case 5:return s({type:"setLoadingPlaces"}),e.next=8,J.get("/".concat(t,".json"),{params:{proximity:r.userLocation.join(",")}});case 8:return a=e.sent,s({type:"setPlaces",payload:a.data.features}),e.abrupt("return",a.data.features);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){H().then((function(e){return s({type:"setUserLocation",payload:e})}))}),[]),Object(j.jsx)(u.Provider,{value:Object(q.a)(Object(q.a)({},r),{},{searchPlacesByTerm:o,setPlaces:function(e){s({type:"setPlaces",payload:e})}}),children:t})};var re=function(){return Object(j.jsx)(ce,{children:Object(j.jsx)(te,{children:Object(j.jsx)(Q,{children:Object(j.jsx)(h.a,{children:Object(j.jsxs)(O.c,{children:[Object(j.jsx)(O.a,{exact:!0,path:"/Packages",component:Z}),Object(j.jsx)(O.a,{exact:!0,path:"/Manage",component:U}),Object(j.jsx)(O.a,{exact:!0,path:"/",component:Z})]})})})})})};a(96);if(i.a.accessToken="pk.eyJ1IjoiY2FybG9zMzg5NyIsImEiOiJjbGEwZW9idWcwNHJ1M3dxZ2doYm10dmJpIn0.Wygg1LWkef9akBZdNzleBA",!navigator.geolocation)throw alert("The application will not work without Geolocation"),new Error("You have to allow Geolocation");s.a.render(Object(j.jsx)(c.a.StrictMode,{children:Object(j.jsx)(re,{})}),document.getElementById("root"))}},[[97,1,2]]]);
//# sourceMappingURL=main.e543feea.chunk.js.map